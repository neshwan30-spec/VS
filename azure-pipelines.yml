// rumble-tester.ts - Deno version
import { serve } from "https://deno.land/std@0.168.0/http/server.ts";

serve(async (req) => {
  const url = new URL(req.url);
  
  if (url.pathname === "/test") {
    const cookie = url.searchParams.get("cookie");
    
    if (!cookie) {
      return new Response("Cookie required", { status: 400 });
    }
    
    const response = await fetch(
      "https://rumble.com/account/overview?mobile=1&app_name=com.rumble.ios.app&app_version=2.8.54.447&os_version=17.7.1&api=6",
      {
        headers: {
          "Cookie": cookie,
          "User-Agent": "Rumble-iOS/447 CFNetwork/1498.700.2 Darwin/23.6.0",
          "Accept": "application/json"
        }
      }
    );
    
    return new Response(JSON.stringify({
      status: response.status,
      data: await response.text()
    }), {
      headers: { "Content-Type": "application/json" }
    });
  }
  
  return new Response("Not found", { status: 404 });
});
