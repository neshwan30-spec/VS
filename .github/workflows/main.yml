name: Simple Windows Tailscale

on: workflow_dispatch

env:
  TAILSCALE_AUTHKEY: ${{ secrets.TAILSCALE_AUTH_TOKEN }}

jobs:
  setup:
    runs-on: windows-latest
    
    steps:
    - name: Validate Secret
      shell: powershell
      run: |
        # Simple check without string manipulation
        if ($env:TAILSCALE_AUTHKEY) {
          Write-Host "✓ TAILSCALE_AUTH_TOKEN is set"
        } else {
          Write-Error "❌ TAILSCALE_AUTH_TOKEN secret is not set!"
          Write-Host "Add it in: Settings > Secrets > Actions"
          exit 1
        }
        
    - name: Install Tailscale
      shell: powershell
      run: |
        Write-Host "Installing Tailscale..."
        msiexec /i "https://pkgs.tailscale.com/stable/tailscale-setup.msi" /quiet /norestart
        Start-Sleep -Seconds 10
        
    - name: Start Tailscale
      shell: powershell
      run: |
        & "C:\Program Files\Tailscale\tailscale.exe" up --auth-key $env:TAILSCALE_AUTHKEY
        
    - name: Check Status
      shell: powershell
      run: |
        # Simple status check
        Start-Sleep -Seconds 5
        & "C:\Program Files\Tailscale\tailscale.exe" status
        
        # Get IP
        $ip = & "C:\Program Files\Tailscale\tailscale.exe" ip --4
        Write-Host "Tailscale IP: $ip"
