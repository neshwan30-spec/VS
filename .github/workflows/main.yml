name: Tailscale Windows Simple

on: workflow_dispatch

jobs:
  tailscale-windows:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Tailscale
      uses: tailscale/github-action@v3
      with:
        version: latest
        authkey: ${{ secrets.TAILSCALE_AUTH_TOKEN }}
        hostname: windows-gh-${{ github.run_id }}
        # Windows-specific options
        args: |
          --accept-dns=true
          --accept-routes=false
          --shields-up=false
          
    - name: Wait for connection
      shell: powershell
      run: |
        # Wait for Tailscale
        $maxWait = 60
        $waitCount = 0
        
        while ($waitCount -lt $maxWait) {
            try {
                $status = tailscale.exe status --json 2>$null | ConvertFrom-Json
                if ($status.BackendState -eq "Running") {
                    Write-Host "✅ Tailscale connected!"
                    tailscale.exe status
                    break
                }
            } catch {
                Write-Host "Waiting... ($waitCount/$maxWait)"
            }
            $waitCount++
            Start-Sleep -Seconds 2
        }
        
        if ($waitCount -ge $maxWait) {
            Write-Host "⚠️ Tailscale may still be connecting"
        }
        
    - name: Run your tasks
      shell: powershell
      run: |
        Write-Host "Your Windows tasks here"
        # Now you can use Tailscale network
