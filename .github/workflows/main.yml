name: Windows Tailscale Direct MSI

on: workflow_dispatch

jobs:
  install:
    runs-on: windows-latest
    
    steps:
    - name: Install Tailscale via MSI
      shell: cmd  # Use cmd for better compatibility
      run: |
        echo Installing Tailscale...
        
        # Use msiexec directly with public URL
        msiexec /i "https://pkgs.tailscale.com/stable/tailscale-setup.msi" /quiet /norestart
        
        timeout /t 10 /nobreak
        
    - name: Verify Installation
      shell: powershell
      run: |
        # Wait for installation to complete
        Start-Sleep -Seconds 15
        
        # Check if installed
        if (Test-Path "C:\Program Files\Tailscale\tailscale.exe") {
            Write-Host "✓ Tailscale installed successfully"
        } else {
            Write-Host "⚠️ Installation may have failed, but continuing..."
        }
        
    - name: Start Tailscale
      shell: powershell
      env:
        TAILSCALE_AUTHKEY: ${{ secrets.TAILSCALE_AUTH_TOKEN }}
      run: |
        # Try to start Tailscale
        try {
            & "C:\Program Files\Tailscale\tailscale.exe" up --auth-key $env:TAILSCALE_AUTHKEY
            Write-Host "Tailscale started"
        } catch {
            Write-Host "Failed to start Tailscale: $_"
        }
